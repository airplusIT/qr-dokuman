<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Yönlendiriliyor...</title>
  <script>
    async function redirectUser() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const role = localStorage.getItem("role"); // "musteri" veya "personel"

      if (!id || !role) {
        alert("Geçersiz istek veya kullanıcı rolü tanımlı değil.");
        return;
      }

      try {
        const response = await fetch("redirects 1.json");
        const text = await response.text();
        const lines = text.trim().split("\n");

        const match = lines.find(line => line.startsWith(id + " "));
        if (!match) {
          alert("Belge bulunamadı.");
          return;
        }

        const filePath = match.split(" ")[1];

        if (filePath.startsWith("docs/" + role)) {
          // Erişim izni var, yönlendir
          window.location.href = `viewer.html?file=${encodeURIComponent(filePath)}`;
        } else {
          alert("Seçilen rol bu dosyaya erişemez.");
        }
      } catch (error) {
        console.error("Yönlendirme hatası:", error);
        alert("Bir hata oluştu.");
      }
    }

    window.onload = redirectUser;
  </script>
</head>
<body>
  <p>Yönlendiriliyorsunuz, lütfen bekleyin...</p>
</body>
</html>
